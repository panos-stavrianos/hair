"use strict";!function(o){"object"==typeof module&&module.exports?module.exports=o:o(Highcharts)}(function(o){var t,n,e,i,s,r;n=(t=o).defined,e=t.each,i=t.extend,s=t.seriesType,t.pick,r=t.Point,s("sankey","column",{colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:undefined,nodeFormatter:function(){return this.point.name},format:undefined,formatter:function(){return""},inside:!0},linkOpacity:.5,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 0.85em">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} \u2192 {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}},{isCartesian:!1,forceDL:!0,createNode:function(o){function n(o,n){return t.find(o,function(o){return o.id===n})}var s,a=n(this.nodes,o);return a||(s=this.options.nodes&&n(this.options.nodes,o),(a=(new r).init(this,i({className:"highcharts-node",isNode:!0,id:o,y:1},s))).linksTo=[],a.linksFrom=[],a.formatPrefix="node",a.name=a.name||a.id,a.getSum=function(){var o=0,t=0;return e(a.linksTo,function(t){o+=t.weight}),e(a.linksFrom,function(o){t+=o.weight}),Math.max(o,t)},a.offset=function(o,t){for(var n=0,e=0;e<a[t].length;e++){if(a[t][e]===o)return n;n+=a[t][e].weight}},a.hasShape=function(){var o=0;return e(a.linksTo,function(t){t.outgoing&&o++}),!a.linksTo.length||o!==a.linksTo.length},this.nodes.push(a)),a},createNodeColumn:function(){var o=this.chart,t=[],n=this.options.nodePadding;return t.sum=function(){var o=0;return e(this,function(t){o+=t.getSum()}),o},t.offset=function(o,e){for(var i=0,s=0;s<t.length;s++){if(t[s]===o)return i;i+=t[s].getSum()*e+n}},t.top=function(e){for(var i=0,s=0;s<t.length;s++)s>0&&(i+=n),i+=t[s].getSum()*e;return(o.plotSizeY-i)/2},t},createNodeColumns:function(){var o=[];return e(this.nodes,function(t){var n,e,i=0;if(0===t.linksTo.length)t.column=0;else{for(n=0;n<t.linksTo.length;n++)(e=t.linksTo[0]).fromNode.column>i&&(i=e.fromNode.column);t.column=i+1}o[t.column]||(o[t.column]=this.createNodeColumn()),o[t.column].push(t)},this),o},pointAttribs:function(o,n){var e=this.options.linkOpacity;return n&&(e=this.options.states[n].linkOpacity||e),{fill:o.isNode?o.color:t.color(o.color).setOpacity(e).get()}},generatePoints:function(){var o={};t.Series.prototype.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,e(this.nodes,function(o){o.linksFrom.length=0,o.linksTo.length=0}),e(this.points,function(t){n(t.from)&&(o[t.from]||(o[t.from]=this.createNode(t.from)),o[t.from].linksFrom.push(t),t.fromNode=o[t.from],t.color=t.options.color||o[t.from].color),n(t.to)&&(o[t.to]||(o[t.to]=this.createNode(t.to)),o[t.to].linksTo.push(t),t.toNode=o[t.to]),t.name=t.name||t.id},this)},translate:function(){this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns();var o=this.chart,t=o.inverted,n=this.options,i=0,s=n.nodeWidth,r=this.nodeColumns,a=(o.plotSizeX-s)/(r.length-1),h=(t?-a:a)*n.curveFactor,l=Infinity;e(this.nodeColumns,function(t){var e=o.plotSizeY-(t.length-1)*n.nodePadding;l=Math.min(l,e/t.sum())}),e(this.nodeColumns,function(n){e(n,function(u){var c=u.getSum(),d=c*l,f=n.top(l)+n.offset(u,l),m=t?o.plotSizeX-i:i;u.sum=c,u.shapeType="rect",u.shapeArgs=t?{x:m-s,y:o.plotSizeY-f-d,width:s,height:d}:{x:m,y:f,width:s,height:d},u.shapeArgs.display=u.hasShape()?"":"none",u.plotY=1,e(u.linksFrom,function(n){var e=n.weight*l,i=u.offset(n,"linksFrom")*l,c=f+i,d=n.toNode,p=r[d.column].top(l)+d.offset(n,"linksTo")*l+r[d.column].offset(d,l),g=s,k=d.column*a,y=n.outgoing;t&&(c=o.plotSizeY-c,p=o.plotSizeY-p,k=o.plotSizeX-k,g=-g,e=-e),n.shapeType="path",n.shapeArgs={d:["M",m+g,c,"C",m+g+h,c,k-h,p,k,p,"L",k+(y?g:0),p+e/2,"L",k,p+e,"C",k-h,p+e,m+g+h,c+e,m+g,c+e,"z"]},n.dlBox={x:m+(k-m+g)/2,y:c+(p-c)/2,height:e,width:0},n.y=n.plotY=1,n.color||(n.color=u.color)})}),i+=a},this)},render:function(){var o=this.points;this.points=this.points.concat(this.nodes),t.seriesTypes.column.prototype.render.call(this),this.points=o},animate:t.Series.prototype.animate},{getClassName:function(){return"highcharts-link "+r.prototype.getClassName.call(this)},isValid:function(){return this.isNode||"number"==typeof this.weight}})});