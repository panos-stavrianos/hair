"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t:t(Highcharts)}(function(t){!function(t){var e=t.each,o=t.pick,n=t.win,a=n.document,i=t.seriesTypes,r=a.createElement("a").download!==undefined;t.setOptions({exporting:{csv:{columnHeaderFormatter:null,dateFormat:"%Y-%m-%d %H:%M:%S",itemDelimiter:",",lineDelimiter:"\n"},showTable:!1},lang:{downloadCSV:"Download CSV",downloadXLS:"Download XLS",viewData:"View data table"}}),t.addEvent(t.Chart.prototype,"render",function(){this.options&&this.options.exporting&&this.options.exporting.showTable&&this.viewData()}),t.Chart.prototype.setUpKeyToAxis=function(){i.arearange&&(i.arearange.prototype.keyToAxis={low:"y",high:"y"})},t.Chart.prototype.getDataRows=function(){var n,a,i,r,s,l,p,c=this.options.exporting&&this.options.exporting.csv||{},d=this.xAxis,x={},m=[],h=[],f=function(e,o,n){if(c.columnHeaderFormatter){var a=c.columnHeaderFormatter(e,o,n);if(!1!==a)return a}return e instanceof t.Axis?e.options.title&&e.options.title.text||(e.isDatetimeAxis?"DateTime":"Category"):e?e.name+(n>1?" ("+o+")":""):"Category"},u=[];for(r in i=0,this.setUpKeyToAxis(),e(this.series,function(n){var a,r=n.options.keys||n.pointArrayMap||["y"],s=r.length,l=!n.requireSorting&&{},p={},m={},g=t.inArray(n.xAxis,d);if(e(r,function(t){var e=(n.keyToAxis&&n.keyToAxis[t]||t)+"Axis";p[t]=n[e]&&n[e].categories||[],m[t]=n[e]&&n[e].isDatetimeAxis}),!1!==n.options.includeInCSVExport&&!1!==n.visible){for(t.find(u,function(t){return t[0]===g})||u.push([g,i]),a=0;a<s;)h.push(f(n,r[a],r.length)),a++;e(n.points,function(e,d){var h,f,u=e.x;for(l&&(l[u]&&(u+="|"+d),l[u]=!0),a=0,x[u]||(x[u]=[],x[u].xValues=[]),x[u].x=e.x,x[u].xValues[g]=e.x,n.xAxis&&"name"!==n.exportKey||(x[u].name=e.name);a<s;)f=e[h=r[a]],x[u][i+a]=o(p[h][f],m[h]?t.dateFormat(c.dateFormat,f):null,f),a++}),i+=a}}),x)x.hasOwnProperty(r)&&m.push(x[r]);for(a=[h],i=u.length;i--;)l=u[i][0],p=u[i][1],n=d[l],m.sort(function(t,e){return t.xValues[l]-e.xValues[l]}),s=f(n),a[0].splice(p,0,s),e(m,function(e){var a=e.name;a||(n.isDatetimeAxis?(e.x instanceof Date&&(e.x=e.x.getTime()),a=t.dateFormat(c.dateFormat,e.x)):a=n.categories?o(n.names[e.x],n.categories[e.x],e.x):e.x),e.splice(p,0,a)});return a=a.concat(m)},t.Chart.prototype.getCSV=function(t){var o="",n=this.getDataRows(),a=this.options.exporting.csv,i=a.itemDelimiter,r=a.lineDelimiter;return e(n,function(e,a){for(var s="",l=e.length,p=t?1.1.toLocaleString()[1]:".";l--;)"string"==typeof(s=e[l])&&(s='"'+s+'"'),"number"==typeof s&&","===p&&(s=s.toString().replace(".",",")),e[l]=s;o+=e.join(i),a<n.length-1&&(o+=r)}),o},t.Chart.prototype.getTable=function(t){var o="<table><thead>",n=this.getDataRows();return e(n,function(e,n){var a,i,r=n?"td":"th",s=t?1.1.toLocaleString()[1]:".";for(o+="<tr>",i=0;i<e.length;i+=1)"number"==typeof(a=e[i])?(a=a.toString(),","===s&&(a=a.replace(".",s)),o+="<"+r+' class="number">'+a+"</"+r+">"):o+="<"+r+' class="text">'+(a===undefined?"":a)+"</"+r+">";o+="</tr>",n||(o+="</thead><tbody>")}),o+="</tbody></table>"},t.Chart.prototype.fileDownload=function(e,o,i){var s,l,p;p=this.options.exporting.filename?this.options.exporting.filename:this.title&&this.title.textStr?this.title.textStr.replace(/ /g,"-").toLowerCase():"chart",n.Blob&&n.navigator.msSaveOrOpenBlob?(l=new n.Blob(["\ufeff"+i],{type:"text/csv"}),n.navigator.msSaveOrOpenBlob(l,p+"."+o)):r?((s=a.createElement("a")).href=e,s.download=p+"."+o,this.container.appendChild(s),s.click(),s.remove()):t.error("The browser doesn't support downloading files")},t.Chart.prototype.downloadCSV=function(){var t=this.getCSV(!0);this.fileDownload("data:text/csv,\ufeff"+encodeURIComponent(t),"csv",t,"text/csv")},t.Chart.prototype.downloadXLS=function(){var t="data:application/vnd.ms-excel;base64,",e='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Ark1</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><style>td{border:none;font-family: Calibri, sans-serif;} .number{mso-number-format:"0.00";} .text{ mso-number-format:"@";}</style><meta name=ProgId content=Excel.Sheet><meta charset=UTF-8></head><body>'+this.getTable(!0)+"</body></html>",o=function(t){return n.btoa(unescape(encodeURIComponent(t)))};this.fileDownload(t+o(e),"xls",e,"application/vnd.ms-excel")},t.Chart.prototype.viewData=function(){this.dataTableDiv||(this.dataTableDiv=a.createElement("div"),this.dataTableDiv.className="highcharts-data-table",this.renderTo.parentNode.insertBefore(this.dataTableDiv,this.renderTo.nextSibling)),this.dataTableDiv.innerHTML=this.getTable()};var s=t.getOptions().exporting;s&&(t.extend(s.menuItemDefinitions,{downloadCSV:{textKey:"downloadCSV",onclick:function(){this.downloadCSV()}},downloadXLS:{textKey:"downloadXLS",onclick:function(){this.downloadXLS()}},viewData:{textKey:"viewData",onclick:function(){this.viewData()}}}),s.buttons.contextButton.menuItems.push("separator","downloadCSV","downloadXLS","viewData")),i.map&&(i.map.prototype.exportKey="name"),i.mapbubble&&(i.mapbubble.prototype.exportKey="name"),i.treemap&&(i.treemap.prototype.exportKey="name")}(t)});