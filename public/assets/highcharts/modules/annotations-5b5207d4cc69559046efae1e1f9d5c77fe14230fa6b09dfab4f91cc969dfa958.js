"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t:t(Highcharts)}(function(t){!function(t){var i=t.merge,e=t.addEvent,r=t.extend,o=t.each,n=t.isString,s=t.isNumber,a=t.defined,h=t.isObject,l=t.inArray,d=t.erase,p=t.find,c=t.format,u=t.pick,f=t.destroyObjectProperties,g=t.Tooltip.prototype,m=t.Series.prototype,y=t.Chart.prototype,b={arrow:{render:!1,id:"arrow",refY:5,refX:5,markerWidth:10,markerHeight:10,children:[{tagName:"path",attrs:{d:"M 0 0 L 10 5 L 0 10 Z",strokeWidth:0}}]}},x={markerSetter:function(t){return function(i){this.attr(t,"url(#"+i+")")}}};r(x,{markerEndSetter:x.markerSetter("marker-end"),markerStartSetter:x.markerSetter("marker-start")}),t.SVGRenderer.prototype.addMarker=function(e,r){var n=u(e,t.uniqueKey()),s=this.createElement("marker").attr({id:n,markerWidth:u(r.markerWidth,20),markerHeight:u(r.markerHeight,20),refX:r.refX||0,refY:r.refY||0,orient:r.orient||"auto"}).add(this.defs),a={stroke:r.color||"none",fill:r.color||"rgba(0, 0, 0, 0.75)"},h=r.children;return s.id=n,o(h,function(t){this.createElement(t.tagName).attr(i(a,t.attrs)).add(s)},this),s};var k=t.MockPoint=function(t,i){this.mock=!0,this.series={visible:!0,chart:t,getPlotBox:m.getPlotBox},this.init(t,i)},v=t.mockPoint=function(t,i){return new k(t,i)};k.prototype={init:function(t,i){var e=i.xAxis,r=a(e)?t.xAxis[e]||t.get(e):null,o=i.yAxis,n=a(o)?t.yAxis[o]||t.get(o):null;r?(this.x=i.x,this.series.xAxis=r):this.plotX=i.x,n?(this.y=i.y,this.series.yAxis=n):this.plotY=i.y},translate:function(){var t=this.series,i=t.xAxis,e=t.yAxis,r=this.plotX,o=this.plotY,n=!0;i&&(this.plotX=r=i.toPixels(this.x,!0),n=r>=0&&r<=i.len),e&&(this.plotY=o=e.toPixels(this.y,!0),n=n&&o>=0&&o<=e.len),this.isInside=n},alignToBox:function(t){t&&this.translate();var i,e=this.plotX,r=this.plotY;return this.series.chart.inverted&&(i=e,e=r,r=i),[e,r,0,0]},getLabelConfig:function(){return{x:this.x,y:this.y,point:this}}},t.defaultOptions.annotations=[];var w=t.Annotation=function(t,e){this.chart=t,this.labels=[],this.shapes=[],this.options=i(this.defaultOptions,e),this.init(t,e)};w.prototype={shapesWithoutBackground:["connector"],attrsMap:{backgroundColor:"fill",borderColor:"stroke",borderWidth:"stroke-width",strokeWidth:"stroke-width",stroke:"stroke",fill:"fill",zIndex:"zIndex",width:"width",height:"height",borderRadius:"r",r:"r",padding:"padding",dashStyle:"dashstyle"},defaultOptions:{visible:!0,labelOptions:{align:"center",allowOverlap:!1,backgroundColor:"rgba(0, 0, 0, 0.75)",borderColor:"black",borderRadius:1,borderWidth:1,crop:!1,formatter:function(){return a(this.y)?this.y:"Annotation label"},overflow:"justify",padding:5,shadow:!1,shape:"callout",style:{fontSize:"11px",fontWeight:"normal",color:"contrast"},useHTML:!1,verticalAlign:"bottom",x:0,y:-16},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1,fill:"rgba(0, 0, 0, 0.75)",r:0},zIndex:6},init:function(){var t=this;o(this.options.labels||[],this.initLabel,this),o(this.options.shapes||[],this.initShape,this),this.chart.labelCollectors.push(function(){var i=[];return o(t.labels,function(t){t.options.allowOverlap||i.push(t)}),i})},redraw:function(){this.group||this.render(),this.redrawItems(this.shapes),this.redrawItems(this.labels)},redrawItems:function(t){for(var i=t.length;i--;)this.redrawItem(t[i])},render:function(){var t=this.chart.renderer,i=this.group=t.g("annotation").attr({zIndex:this.options.zIndex,visibility:this.options.visible?"visible":"hidden"}).add();this.shapesGroup=t.g("annotation-shapes").add(i),this.labelsGroup=t.g("annotation-labels").attr({translateX:0,translateY:0}).add(i),this.shapesGroup.clip(this.chart.plotBoxClip)},setVisible:function(t){var i=this.options,e=u(t,!i.visible);this.group.attr({visibility:e?"visible":"hidden"}),i.visible=e},destroy:function(){var t=this.chart;o(this.labels,function(t){t.destroy()}),o(this.shapes,function(t){t.destroy()}),f(this,t)},initShape:function(t){var e=this.chart.renderer,o=i(this.options.shapeOptions,t),n=this.attrsFromOptions(o),s=e[o.type]?o.type:"rect",a=e[s](0,-9e9,0,0);a.points=[],a.type=s,a.options=o,a.itemType="shape","path"===s&&r(a,{markerStartSetter:x.markerStartSetter,markerEndSetter:x.markerEndSetter,markerStart:x.markerStart,markerEnd:x.markerEnd}),a.attr(n),this.shapes.push(a)},initLabel:function(t){var e=i(this.options.labelOptions,t),r=e.style,o=this.attrsFromOptions(e),n=this.chart.renderer.label("",0,-9e9,e.shape,null,null,e.useHTML,null,"annotation-label");"contrast"===r.color&&(r.color=this.chart.renderer.getContrast(l(e.shape,this.shapesWithoutBackground)>-1?"#FFFFFF":e.backgroundColor)),n.points=[],n.options=e,n.itemType="label",n.labelrank=e.labelrank,n.annotation=this,n.attr(o).css(r).shadow(e.shadow),this.labels.push(n)},redrawItem:function(t){var i,e=this.linkPoints(t),r=t.options;e.length?(t.parentGroup||this.renderItem(t),"label"===t.itemType&&(i=r.format||r.text,t.attr({text:i?c(i,e[0].getLabelConfig()):r.formatter.call(e[0])})),"path"===t.type?this.redrawPath(t):this.alignItem(t,!t.placed)):this.destroyItem(t)},destroyItem:function(t){d(this[t.itemType+"s"],t),t.destroy()},pointItem:function(t,i){return i&&null!==i.series||(h(t)?i=v(this.chart,t):n(t)&&(i=this.chart.get(t)||null)),i},linkPoints:function(i){var e,r,o=i.options.points||i.options.point&&t.splat(i.options.point),n=i.points,s=o&&o.length;for(e=0;e<s;e++){if(!(r=this.pointItem(o[e],n[e])))return i.points=[];n[e]=r}return n},alignItem:function(t,i){var e=this.itemAnchor(t,t.points[0]),r=this.itemPosition(t,e);r?(t.alignAttr=r,t.placed=!0,r.anchorX=e.absolutePosition.x,r.anchorY=e.absolutePosition.y,t[i?"attr":"animate"](r)):(t.placed=!1,t.attr({x:0,y:-9e9}))},redrawPath:function(t,i){var e,r,o,n,s=t.points,a=t["stroke-width"],h=["M"],l=0,d=0,p=s&&s.length;if(p)do{o=s[l],r=this.itemAnchor(t,o).absolutePosition,h[++d]=r.x,h[++d]=r.y,0===(e=d%5)&&(h[e+1]===h[e+4]&&(h[e+1]=h[e+4]=Math.round(h[e+1])-a%2/2),h[e+2]===h[e+5]&&(h[e+2]=h[e+5]=Math.round(h[e+2])+a%2/2)),l<p-1&&(h[++d]="L"),n=o.series.visible}while(++l<p&&n);n?t[i?"attr":"animate"]({d:h}):t.attr({d:"M 0 "+-9e9}),t.placed=n},renderItem:function(t){t.add("label"===t.itemType?this.labelsGroup:this.shapesGroup),this.setItemMarkers(t)},setItemMarkers:function(t){var e=t.options,r=this.chart,n=r.options.defs.markers,s=e.fill,h=a(s)&&"none"!==s?s:e.stroke;o(["markerStart","markerEnd"],function(o){var s,a,l,d=e[o];if(d){for(l in n)if(d===(s=n[l]).id){a=s;break}a&&(s=t[o]=r.renderer.addMarker(null,i(a,{color:h})),t.attr(o,s.id))}})},itemAnchor:function(t,e){var r=e.series.getPlotBox(),o=e.mock?e.alignToBox(!0):g.getAnchor.call({chart:this.chart},e),n={x:o[0],y:o[1],height:o[2]||0,width:o[3]||0};return{relativePosition:n,absolutePosition:i(n,{x:n.x+r.translateX,y:n.y+r.translateY})}},itemPosition:function(t,i){var e,o,n,s,h=this.chart,l=t.points[0],d=t.options,p=i.absolutePosition,c=i.relativePosition,f=l.series.visible&&!1!==l.isInside;return f&&(a(d.distance)||d.positioner?e=(d.positioner||g.getPosition).call({chart:h,distance:u(d.distance,16)},t.width,t.height,{plotX:c.x,plotY:c.y,negative:l.negative,ttBelow:l.ttBelow,h:c.height||c.width}):(o={x:p.x,y:p.y,width:0,height:0},e=this.alignedPosition(r(d,{width:t.width,height:t.height}),o),"justify"===t.options.overflow&&(e=this.alignedPosition(this.justifiedOptions(t,d,e),o))),d.crop&&(n=e.x-h.plotLeft,s=e.y-h.plotTop,f=h.isInsidePlot(n,s)&&h.isInsidePlot(n+t.width,s+t.height))),f?e:null},alignedPosition:function(t,i){var e,r,o=t.align,n=t.verticalAlign,s=(i.x||0)+(t.x||0),a=(i.y||0)+(t.y||0);return"right"===o?e=1:"center"===o&&(e=2),e&&(s+=(i.width-(t.width||0))/e),"bottom"===n?r=1:"middle"===n&&(r=2),r&&(a+=(i.height-(t.height||0))/r),{x:Math.round(s),y:Math.round(a)}},justifiedOptions:function(t,i,e){var r,o=this.chart,n=i.align,s=i.verticalAlign,a=t.box?0:t.padding||0,h=t.getBBox(),l={align:n,verticalAlign:s,x:i.x,y:i.y,width:t.width,height:t.height},d=e.x-o.plotLeft,p=e.y-o.plotTop;return(r=d+a)<0&&("right"===n?l.align="left":l.x=-r),(r=d+h.width-a)>o.plotWidth&&("left"===n?l.align="right":l.x=o.plotWidth-r),(r=p+a)<0&&("bottom"===s?l.verticalAlign="top":l.y=-r),(r=p+h.height-a)>o.plotHeight&&("top"===s?l.verticalAlign="bottom":l.y=o.plotHeight-r),l},attrsFromOptions:function(t){var i,e,r=this.attrsMap,o={};for(i in t)(e=r[i])&&(o[e]=t[i]);return o}},t.extend(y,{addAnnotation:function(t,i){var e=new w(this,t);return this.annotations.push(e),u(i,!0)&&e.redraw(),e},removeAnnotation:function(t){var i=this.annotations,e=p(i,function(i){return i.options.id===t});e&&(d(i,e),e.destroy())},drawAnnotations:function(){var t=this.plotBoxClip,i=this.plotBox;t?t.attr(i):this.plotBoxClip=this.renderer.clipRect(i),o(this.annotations,function(t){t.redraw()})}}),y.callbacks.push(function(t){t.annotations=[],o(t.options.annotations,function(i){t.addAnnotation(i,!1)}),t.drawAnnotations(),e(t,"redraw",t.drawAnnotations),e(t,"destroy",function(){var i=t.plotBoxClip;i&&i.destroy&&i.destroy()})}),t.wrap(y,"getContainer",function(t){t.call(this);var e,r,o,n=this.renderer,s=this.options;for(e in s.defs=i(s.defs||{},{markers:b}),r=s.defs.markers)o=r[e],u(o.render,!0)&&n.addMarker(o.id,o)}),t.SVGRenderer.prototype.symbols.connector=function(t,i,e,r,o){var n,a,h=o&&o.anchorX,l=o&&o.anchorY,d=e/2;return s(h)&&s(l)&&(n=["M",h,l],(a=i-l)<0&&(a=-r-a),a<e&&(d=h<t+e/2?a:e-a),l>i+r?n.push("L",t+d,i+r):l<i?n.push("L",t+d,i):h<t?n.push("L",t,i+r/2):h>t+e&&n.push("L",t+e,i+r/2)),n||[]}}(t)});