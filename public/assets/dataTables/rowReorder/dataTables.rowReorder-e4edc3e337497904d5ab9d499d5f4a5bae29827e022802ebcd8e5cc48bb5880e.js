/*! RowReorder 1.2.4
 * 2015-2018 SpryMedia Ltd - datatables.net/license
 */
/**
 * @summary     RowReorder
 * @description Row reordering extension for DataTables
 * @version     1.2.4
 * @file        dataTables.rowReorder.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2015-2018 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],function(e){return t(e,window,document)}):"object"==typeof exports?module.exports=function(e,o){return e||(e=window),o&&o.fn.dataTable||(o=require("datatables.net")(e,o).$),t(o,e,e.document)}:t(jQuery,window,document)}(function(t,e,o,r){"use strict";var n=t.fn.dataTable,i=function(e,o){if(!n.versionCheck||!n.versionCheck("1.10.8"))throw"DataTables RowReorder requires DataTables 1.10.8 or newer";this.c=t.extend(!0,{},n.defaults.rowReorder,i.defaults,o),this.s={bodyTop:null,dt:new n.Api(e),getDataFn:n.ext.oApi._fnGetObjectDataFn(this.c.dataSrc),middles:null,scroll:{},scrollInterval:null,setDataFn:n.ext.oApi._fnSetObjectDataFn(this.c.dataSrc),start:{top:0,left:0,offsetTop:0,offsetLeft:0,nodes:[]},windowHeight:0,documentOuterHeight:0,domCloneOuterHeight:0},this.dom={clone:null,dtScroll:t("div.dataTables_scrollBody",this.s.dt.table().container())};var r=this.s.dt.settings()[0],s=r.rowreorder;if(s)return s;r.rowreorder=this,this._constructor()};t.extend(i.prototype,{_constructor:function(){var e=this,o=this.s.dt,r=t(o.table().node());"static"===r.css("position")&&r.css("position","relative"),t(o.table().container()).on("mousedown.rowReorder touchstart.rowReorder",this.c.selector,function(r){if(e.c.enable){if(t(r.target).is(e.c.excludedChildren))return!0;var n=t(this).closest("tr"),i=o.row(n);return i.any()?(e._emitEvent("pre-row-reorder",{node:i.node(),index:i.index()}),e._mouseDown(r,n),!1):void 0}}),o.on("destroy.rowReorder",function(){t(o.table().container()).off(".rowReorder"),o.off(".rowReorder")})},_cachePositions:function(){var r=this.s.dt,n=t(r.table().node()).find("thead").outerHeight(),i=t.unique(r.rows({page:"current"}).nodes().toArray()),s=t.map(i,function(e){return t(e).position().top-n}),d=t.map(s,function(e,o){return s.length<o-1?(e+s[o+1])/2:(e+e+t(r.row(":last-child").node()).outerHeight())/2});this.s.middles=d,this.s.bodyTop=t(r.table().body()).offset().top,this.s.windowHeight=t(e).height(),this.s.documentOuterHeight=t(o).outerHeight()},_clone:function(e){var o=this.s.dt,r=t(o.table().node().cloneNode(!1)).addClass("dt-rowReorder-float").append("<tbody/>").append(e.clone(!1)),n=e.outerWidth(),i=e.outerHeight(),s=e.children().map(function(){return t(this).width()});r.width(n).height(i).find("tr").children().each(function(t){this.style.width=s[t]+"px"}),r.appendTo("body"),this.dom.clone=r,this.s.domCloneOuterHeight=r.outerHeight()},_clonePosition:function(t){var e,o=this.s.start,r=this._eventToPage(t,"Y")-o.top,n=this._eventToPage(t,"X")-o.left,i=this.c.snapX,s=r+o.offsetTop;e=!0===i?o.offsetLeft:"number"==typeof i?o.offsetLeft+i:n+o.offsetLeft,s<0?s=0:s+this.s.domCloneOuterHeight>this.s.documentOuterHeight&&(s=this.s.documentOuterHeight-this.s.domCloneOuterHeight),this.dom.clone.css({top:s,left:e})},_emitEvent:function(e,o){this.s.dt.iterator("table",function(r){t(r.nTable).triggerHandler(e+".dt",o)})},_eventToPage:function(t,e){return-1!==t.type.indexOf("touch")?t.originalEvent.touches[0]["page"+e]:t["page"+e]},_mouseDown:function(r,n){var i=this,s=this.s.dt,d=this.s.start,a=n.offset();d.top=this._eventToPage(r,"Y"),d.left=this._eventToPage(r,"X"),d.offsetTop=a.top,d.offsetLeft=a.left,d.nodes=t.unique(s.rows({page:"current"}).nodes().toArray()),this._cachePositions(),this._clone(n),this._clonePosition(r),this.dom.target=n,n.addClass("dt-rowReorder-moving"),t(o).on("mouseup.rowReorder touchend.rowReorder",function(t){i._mouseUp(t)}).on("mousemove.rowReorder touchmove.rowReorder",function(t){i._mouseMove(t)}),t(e).width()===t(o).width()&&t(o.body).addClass("dt-rowReorder-noOverflow");var l=this.dom.dtScroll;this.s.scroll={windowHeight:t(e).height(),windowWidth:t(e).width(),dtTop:l.length?l.offset().top:null,dtLeft:l.length?l.offset().left:null,dtHeight:l.length?l.outerHeight():null,dtWidth:l.length?l.outerWidth():null}},_mouseMove:function(e){this._clonePosition(e);for(var o=this._eventToPage(e,"Y")-this.s.bodyTop,r=this.s.middles,n=null,i=this.s.dt,s=i.table().body(),d=0,a=r.length;d<a;d++)if(o<r[d]){n=d;break}if(null===n&&(n=r.length),null===this.s.lastInsert||this.s.lastInsert!==n){if(0===n)this.dom.target.prependTo(s);else{var l=t.unique(i.rows({page:"current"}).nodes().toArray());n>this.s.lastInsert?this.dom.target.insertAfter(l[n-1]):this.dom.target.insertBefore(l[n])}this._cachePositions(),this.s.lastInsert=n}this._shiftScroll(e)},_mouseUp:function(){var e,r,n=this,i=this.s.dt,s=this.c.dataSrc;this.dom.clone.remove(),this.dom.clone=null,this.dom.target.removeClass("dt-rowReorder-moving"),t(o).off(".rowReorder"),t(o.body).removeClass("dt-rowReorder-noOverflow"),clearInterval(this.s.scrollInterval),this.s.scrollInterval=null;var d=this.s.start.nodes,a=t.unique(i.rows({page:"current"}).nodes().toArray()),l={},h=[],c=[],u=this.s.getDataFn,f=this.s.setDataFn;for(e=0,r=d.length;e<r;e++)if(d[e]!==a[e]){var w=i.row(a[e]).id(),p=i.row(a[e]).data(),g=i.row(d[e]).data();w&&(l[w]=u(g)),h.push({node:a[e],oldData:u(p),newData:u(g),newPosition:e,oldPosition:t.inArray(a[e],d)}),c.push(a[e])}var m=[h,{dataSrc:s,nodes:c,values:l,triggerRow:i.row(this.dom.target)}];this._emitEvent("row-reorder",m);var v=function(){if(n.c.update){for(e=0,r=h.length;e<r;e++){var t=i.row(h[e].node).data();f(t,h[e].newData),i.columns().every(function(){this.dataSrc()===s&&i.cell(h[e].node,this.index()).invalidate("data")})}n._emitEvent("row-reordered",m),i.draw(!1)}};this.c.editor?(this.c.enable=!1,this.c.editor.edit(c,!1,t.extend({submit:"changed"},this.c.formOptions)).multiSet(s,l).one("preSubmitCancelled.rowReorder",function(){n.c.enable=!0,n.c.editor.off(".rowReorder"),i.draw(!1)}).one("submitUnsuccessful.rowReorder",function(){i.draw(!1)}).one("submitSuccess.rowReorder",function(){v()}).one("submitComplete",function(){n.c.enable=!0,n.c.editor.off(".rowReorder")}).submit()):v()},_shiftScroll:function(t){var e,r,n=this,i=(this.s.dt,this.s.scroll),s=!1,d=5,a=65,l=t.pageY-o.body.scrollTop;l<a?e=-1*d:l>i.windowHeight-a&&(e=d),null!==i.dtTop&&t.pageY<i.dtTop+a?r=-1*d:null!==i.dtTop&&t.pageY>i.dtTop+i.dtHeight-a&&(r=d),e||r?(i.windowVert=e,i.dtVert=r,s=!0):this.s.scrollInterval&&(clearInterval(this.s.scrollInterval),this.s.scrollInterval=null),!this.s.scrollInterval&&s&&(this.s.scrollInterval=setInterval(function(){if(i.windowVert&&(o.body.scrollTop+=i.windowVert),i.dtVert){var t=n.dom.dtScroll[0];i.dtVert&&(t.scrollTop+=i.dtVert)}},20))}}),i.defaults={dataSrc:0,editor:null,enable:!0,formOptions:{},selector:"td:first-child",snapX:!1,update:!0,excludedChildren:"a"};var s=t.fn.dataTable.Api;return s.register("rowReorder()",function(){return this}),s.register("rowReorder.enable()",function(t){return t===r&&(t=!0),this.iterator("table",function(e){e.rowreorder&&(e.rowreorder.c.enable=t)})}),s.register("rowReorder.disable()",function(){return this.iterator("table",function(t){t.rowreorder&&(t.rowreorder.c.enable=!1)})}),i.version="1.2.4",t.fn.dataTable.RowReorder=i,t.fn.DataTable.RowReorder=i,t(o).on("init.dt.dtr",function(e,o){if("dt"===e.namespace){var r=o.oInit.rowReorder,s=n.defaults.rowReorder;if(r||s){var d=t.extend({},r,s);!1!==r&&new i(o,d)}}}),i});